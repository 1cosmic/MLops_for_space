---
# tasks file for docker

- block:
  - name: add docker GPG key
    apt_key:
      url: https://download.docker.com/linux/ubuntu/gpg
      state: present
    
  - name: add it repository
    apt_repository:
      repo: 'deb [arch=amd64] https://download.docker.com/linux/ubuntu {{ ansible_distribution_release }} stable'
      state: present
    
  - name: update cache after it
    apt:
      update_cache: yes
  
  - name: install docker
    apt:
      name: docker-ce
      state: present

  - name: run & check service of docker's exist
    service:
      name: docker
      state: started
      enabled: yes    # enable it!

  - name: add users in docker-group
    user:
      name: "{{ item }}"
      state: present
      groups: docker
      append: yes

    loop:
      - "{{ users_to_docker_group }}"
      
  - name: reboot server
    reboot:
      reboot_timeout: 600
    
  - name: check of running docker-service after reboot
    service:
      name: docker
      state: started

  become: yes